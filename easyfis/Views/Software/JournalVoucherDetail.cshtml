@{
    var JVId = Request.QueryString["JournalVoucherId"];
    var branchId = Request.QueryString["BranchId"];
}
<!DOCTYPE html>
<html>
<head>
    <!-- Meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="Some slide and push menu demos using CSS3 transitions.">

    <!-- Title of the Page -->
    <title>Journal Voucher</title>

    <!-- CSS StyleSheets-->
    @Styles.Render("~/Font-Awesome/css")
    @Styles.Render("~/Content/Software-css")
    @Styles.Render("~/WijmoCSS/Wijmo-css")
</head>
<body>
    <div id="wrapper" class="wrapper">
        <!-- Header -->
        @Html.Partial("_SoftwareHeader")

        <!-- Section -->
        <section>
            <br /><br /><br />
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <h4><img src='~/images/Icons/iJournal.png'> Journal Voucher - Detail</h4>
                    </div>
                </div>
                <div class="row">
                    <hr />
                    <div class="col-md-6">
                        <h4 id="journalVoucherDetailLabel">Your Branch</h4>
                    </div>
                    <div class="col-md-6" align="right">
                        <button class="btn btn-primary btn-sm" id="cmdSaveJournalVoucher" onclick="cmdJournalVoucherSaveButton_OnClick()"><i class="fa fa-save"></i> Save</button>
                        <button class="btn btn-primary btn-sm" id="cmdEditJournalVoucher" onclick=""><i class="fa fa-pencil"></i> Edit</button>
                        <button class="btn btn-primary btn-sm" id="cmdPreviewJournalVoucher" onclick=""><i class="fa fa-search"></i> Preview</button>
                        <button class="btn btn-primary btn-sm" id="cmdPrintJournalVoucher" onclick=""><i class="fa fa-print"></i> Print</button>
                        <button onclick="window.location.href = '@Url.Action("JournalVoucher", "Software", new { BranchId = branchId })'" class="btn btn-danger btn-sm" id="cmdCloseJournalVoucher"><i class="fa fa-times"></i> Close</button>
                    </div>
                </div>
                @*<hr />*@
                <div class="well">
                    <form id="journalVoucherDetailForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Branch:</label>
                                    <div id="branch_Id" class="comboBox-wide"></div>

                                    <input type="hidden" id="branch_Id_data" class="requiredJournalVoucher" required />
                                    <input type="hidden" id="branch_selectedValue" />
                                </div>
                                <div class="form-group">
                                    <label>Journal Voucher Number:</label>
                                    <input type="text" id="journalVoucher_No" class="form-control input-sm requiredJournalVoucher">
                                </div>
                                <div class="form-group">
                                    <label>Manual Journal Voucher Number:</label>
                                    <input type="text" id="manual_JournalVoucher_No" class="form-control input-sm requiredJournalVoucher">
                                </div>
                                <div class="form-group">
                                    <label>Particulars:</label>
                                    <textarea type="text" id="journalVoucher_Particulars" class="form-control textarea-custom-JV requiredJournalVoucher"></textarea>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Prepared by:</label>
                                    <div id="preparedByUserId" class="comboBox-wide"></div>

                                    <input type="hidden" id="preparedByUserId_Data" class="requiredJournalVoucher" required />
                                    <input type="hidden" id="preparedByUserId_selectedValue" />
                                </div>
                                <div class="form-group">
                                    <label>Checked by:</label>
                                    <div id="checkedByUserId" class="comboBox-wide"></div>

                                    <input type="hidden" id="checkedByUserId_Data" class="requiredJournalVoucher" required />
                                    <input type="hidden" id="checkedByUserId_selectedValue" />
                                </div>
                                <div class="form-group">
                                    <label>Approved by:</label>
                                    <div id="approvedByUserId" class="comboBox-wide"></div>

                                    <input type="hidden" id="approvedByUserId_Data" class="requiredJournalVoucher" required />
                                    <input type="hidden" id="approvedByUserId_selectedValue" />
                                </div>
                                <div class="form-group">
                                    <label>Journal Voucher Date:</label>

                                    <div id="journalVoucher_Date" class="comboBox-wide"></div>
                                    <input type="hidden" id="journalVoucher_date_Data" class="input-sm requiredJournalVoucher" required />
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <hr class="divider" />
                <!-- Branch List -->
                <div id="JournalVoucherLineList">
                    <div class="row">
                        <div class="col-lg-12">
                            <h4 id="journalVoucherNameLabel">Journal Voucher Line (Empty)</h4>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="input-group">
                                <span class="input-group-btn">
                                    <button class="btn btn-default btn-sm" type="button" readonly>
                                        <i class="fa fa-search"></i>
                                    </button>
                                </span>
                                <input type="text" class="form-control input-sm" id="InputFilterJournalVoucherLine" placeholder="Search Journal Voucher Number">
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <button class="btn btn-primary btn-sm pull-right" id="cmdJournalVoucherLineAddJournalVoucherLineButton" onclick="cmdJournalVoucherLineAddJournalVoucherLineButton_OnClick()"><i class="fa fa-plus"></i> Add</button>
                        </div>
                    </div>
                    <br />
                    <div class="row" align="left">
                        <div class="col-lg-12">
                            <div id="JournalVoucherLineGrid" class="grid" align="left"></div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="btn-group col-md-7" id="naviagtionPageGridJournalVoucherLine">
                            <button type="button" class="btn btn-default" id="btnMoveToFirstPageGridJournalVoucherLine">
                                <span class="glyphicon glyphicon-fast-backward"></span>
                            </button>
                            <button type="button" class="btn btn-default" id="btnMoveToPreviousPageGridJournalVoucherLine">
                                <span class="glyphicon glyphicon-step-backward"></span>
                            </button>
                            <button type="button" class="btn btn-default" disabled style="width: 100px" id="btnCurrentPageGridJournalVoucherLine"></button>
                            <button type="button" class="btn btn-default" id="btnMoveToNextPageGridJournalVoucherLine">
                                <span class="glyphicon glyphicon-step-forward"></span>
                            </button>
                            <button type="button" class="btn btn-default" id="btnMoveToLastPageGridJournalVoucherLine">
                                <span class="glyphicon glyphicon-fast-forward"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Branch Edit Detail -->
        <div class="modal fade" id="journalVoucherLineEdit" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" id="JournalVoucherLineNameModalLabel">Journal Voucher Line - Detail</h4>
                    </div>
                    <div class="modal-body">
                        <form id="journalVoucherDetailForm">
                            <input type="hidden" class="form-control" id="JVL_Id" />
                            <input type="hidden" class="form-control" id="JVL_JVId" />
                            <dl class="dl-horizontal">
                                <dt>Branch:</dt>
                                <dd>
                                    <div id="JVL_Branch_Id" class="comboBox-wide"></div>

                                    <input type="hidden" id="JVL_Branch_Id_Data" class="requiredJournalVoucherLine" />
                                    <input type="hidden" id="JVL_Branch_Id_selectedValue" />
                                </dd>
                                <dt>Account:</dt>
                                <dd>
                                    <div id="JVL_Account_Id" class="comboBox-wide"></div>

                                    <input type="hidden" id="JVL_Account_Id_Data" class="requiredJournalVoucherLine" />
                                    <input type="hidden" id="JVL_Account_Id_selectedValue" />
                                </dd>
                                <dt>Aritcle</dt>
                                <dd>
                                    <div id="JVL_Aritcle_Id" class="comboBox-wide"></div>

                                    <input type="hidden" id="JVL_Aritcle_Id_Data" class="requiredJournalVoucherLine" />
                                    <input type="hidden" id="JVL_Aritcle_Id_selectedValue" />
                                </dd>
                                <dt>Particulars:</dt>
                                <dd><textarea id="JVL_Particulars" class="form-control textarea-custom-JV requiredJournalVoucherLine"></textarea></dd>
                                <dt>Debit Amount:</dt>
                                <dd><input type="text" id="JVL_DebitAmount" class="form-control input-sm requiredJournalVoucherLine" /></dd>
                                <dt>Credit Amount:</dt>
                                <dd><input type="text" id="JVL_CreditAmount" class="form-control input-sm requiredJournalVoucherLine" /></dd>
                                <dt>APRRId:</dt>
                                <dd><input type="text" id="JVL_APRRId" class="form-control input-sm requiredJournalVoucherLine" /></dd>
                                <dt>ARSIId:</dt>
                                <dd><input type="text" id="JVL_ARSIId" class="form-control input-sm requiredJournalVoucherLine" /></dd>
                                <dt>Is Clear:</dt>
                                <dd><input type="checkbox" id="JVL_IsClear" class="requiredJournalVoucherLine" /></dd>
                            </dl>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary btn-sm" id="cmdSaveJournalVoucherLineButton" onclick="cmdJournalVoucherLineSaveButton_OnClick()"><i class="fa fa-save"></i> Save</button>
                        <button type="button" id="cmdJournalVoucherLineDetailCloseButton" class="btn btn-danger btn-sm" data-dismiss="modal"><i class="fa fa-close"></i> Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Journal Voucher Line Delete Modal Confirmation -->
        <div class="modal fade" id="deleteJournalVoucherConfirm" role="dialog">
            <div class="modal-dialog modal-sm">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Delete Journal Voucher Line <i class="fa fa-trash"></i></h4>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this?
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger btn-sm" id="cmdConfirmDeleteJournalVoucherLine" onclick="cmdJournalVoucherConfirmDeleteButton_OnClick()"><i class="fa fa-trash"></i> Delete</button>
                        <button type="button" id="cmdConfirmDeleteCloseButtonJournalVoucherLine" class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-close"></i> Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div class="modal fade" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="Loading..." aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class=" modal-dialog modal-sm">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body">
                        <h4>Loading ...</h4>
                    </div>
                    <div class="modal-footer">
                        <img class="img-thumbnail img-responsive center-block img-custom" src='~/images/loading/progress_bar.gif'>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        @Html.Partial("_SoftwareFooter")
    </div>

    <!-- SideBar Menu -->
    @Html.Partial("_SoftwareSideBarMenu")

    <div id="c-mask" class="c-mask"></div><!-- /c-mask -->
    <!-- Scripts JavaScripts -->
    @Scripts.Render("~/Scripts/Software-js")
    @Scripts.Render("~/WijmoScripts/Wijmo-js")
    <script type="text/javascript">
    // ================
    // Global Variables
    // ================
    var journalVouchers;

    var journalVoucherLines;
    var journalVoucherLineGrid;

    var branches;
    var cboBranch;

    var journalVoucherDate;

    var users;

    var cboUserPreparedBy;
    var cboUserCheckedBy;
    var cboUserApprovedBy;

    var accounts;
    var articles;

    var cboBranchJVL;
    var cboAccountJVL;
    var cboArticleJVL;

    var btnFirstPageGridJournalVoucherLine;
    var btnPreviousPageGridJournalVoucherLine;
    var btnNextPageGridJournalVoucherLine;
    var btnLastPageGridJournalVoucherLine;
    var btnCurrentPageGridJournalVoucherLine;

    // =========================
    // GET Journal Voucher by Id
    // =========================
    function getJournalVoucherLastInsertedId() {
        var journalVouchers = new wijmo.collections.ObservableArray;
        $.ajax({
            url: '/api/listJournalVoucher',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (Results) {
                if (Results.length > 0) {
                    for (i = 0; i < Results.length; i++) {
                        journalVouchers.push({
                            Id: Results.Id,
                            BranchId: Results[i]["BranchId"],
                            Branch: Results[i]["Branch"],
                            JVNumber: Results[i]["JVNumber"],
                            ManualJVNumber: Results[i]["ManualJVNumber"],
                            JVDate: Results[i]["JVDate"],
                            Particulars: Results[i]["Particulars"],
                            PreparedById: Results[i]["PreparedById"],
                            PreparedBy: Results[i]["PreparedBy"],
                            CheckedById: Results[i]["CheckedById"],
                            CheckedBy: Results[i]["CheckedBy"],
                            ApprovedById: Results[i]["ApprovedById"],
                            ApprovedBy: Results[i]["ApprovedBy"],
                            IsLocked: Results[i]["IsLocked"],
                            CreatedById: Results[i]["CreatedById"],
                            CreatedBy: Results[i]["CreatedBy"],
                            CreatedDateTime: Results[i]["CreatedDateTime"],
                            UpdatedById: Results[i]["UpdatedById"],
                            UpdatedBy: Results[i]["UpdatedBy"],
                            UpdatedDateTime: Results[i]["UpdatedDateTime"]
                        });
                        var journalVoucherId = Results[i]["Id"];
                        var JournalVoucherNumber = Results[i]["JVNumber"];
                    }
                    if (JournalVoucherNumber == document.getElementById('journalVoucher_No').value) {
                        //window.location.href = '/Software/JournalVoucherDetail/?Id=' + journalVoucherId;
                        window.location = '/Software/JournalVoucherDetail?JournalVoucherId=' + journalVoucherId + '&branchId=' + @branchId;
                        window.setTimeout(function () { location.reload() }, 1000);
                    }
                }

            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        });
        return journalVouchers;
    }

    // =========================
    // GET Journal Voucher by Id
    // =========================
    function getJournalVoucherById() {
        var journalVouchers = new wijmo.collections.ObservableArray;
        var journalVoucherId = @JVId
        $.ajax({
            url: '/api/journalVoucher/' + journalVoucherId,
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (Results) {
                if (Results.length > 0) {
                    journalVouchers.push({
                        Id: Results.Id,
                        BranchId: Results.BranchId,
                        Branch: Results.Branch,
                        JVNumber: Results.JVNumber,
                        ManualJVNumber: Results.ManualJVNumber,
                        JVDate: Results.JVDate,
                        Particulars: Results.Particulars,
                        PreparedById: Results.PreparedById,
                        PreparedBy: Results.PreparedBy,
                        CheckedById: Results.CheckedById,
                        CheckedBy: Results.CheckedBy,
                        ApprovedById: Results.ApprovedById,
                        ApprovedBy: Results.ApprovedBy,
                        IsLocked: Results.IsLocked,
                        CreatedById: Results.CreatedById,
                        CreatedBy: Results.CreatedBy,
                        CreatedDateTime: Results.CreatedDateTime,
                        UpdatedById: Results.UpdatedById,
                        UpdatedBy: Results.UpdatedBy,
                        UpdatedDateTime: Results.UpdatedDateTime
                    });
                }

                getBranchesForComboBox();
                getUsersForComboBox();

                document.getElementById('branch_Id_data').value = Results.BranchId;
                document.getElementById('branch_selectedValue').value = Results.Branch;
                document.getElementById('journalVoucher_No').value = Results.JVNumber;
                document.getElementById('manual_JournalVoucher_No').value = Results.ManualJVNumber;
                document.getElementById('journalVoucher_date_Data').value = Results.JVDate;
                document.getElementById('journalVoucher_Particulars').value = Results.Particulars;

                document.getElementById('preparedByUserId_Data').value = Results.PreparedById;
                document.getElementById('preparedByUserId_selectedValue').value = Results.PreparedBy;
                document.getElementById('checkedByUserId_Data').value = Results.CheckedById;
                document.getElementById('checkedByUserId_selectedValue').value = Results.CheckedBy;
                document.getElementById('approvedByUserId_Data').value = Results.ApprovedById;
                document.getElementById('approvedByUserId_selectedValue').value = Results.ApprovedBy;

                document.getElementById('createdBy').innerHTML = Results.CreatedBy;
                document.getElementById('createdDate').innerHTML = Results.CreatedDateTime;
                document.getElementById('updatedBy').innerHTML = Results.UpdatedBy;
                document.getElementById('updatedDate').innerHTML = Results.UpdatedDateTime;

                var journalVoucherDate = Results.JVDate;
                journalVoucherDate = new wijmo.input.InputDate('#journalVoucher_Date', {
                    format: 'MM/dd/yyyy',
                    value: new Date(journalVoucherDate),
                    mask: '99/99/9999',
                    onValueChanged: function () {
                        document.getElementById('journalVoucher_date_Data').value = this.value.toLocaleDateString();
                    }
                });
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        });
        return journalVouchers;
    }

    // ========================
    // GET Branch for Combo Box
    // ========================
    function getBranchesForComboBox() {
        branches = new wijmo.collections.ObservableArray();
        $.ajax({
            url: '/api/listBranch',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (results) {
                if (results.length > 0) {
                    for (i = 0; i < results.length; i++) {
                        branches.push({
                            BranchId: results[i]["Id"],
                            BranchBranch: results[i]["Branch"]
                        });
                    }
                    createCboBranch(branches);
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        }
        );
    }

    // ======================
    // Combo Box for Branches
    // ======--==============
    function createCboBranch(branches) {
        var branchCollections = new wijmo.collections.CollectionView(branches);
        var branchList = new Array();
        for (var i = 0; i < branchCollections.items.length; i++) {
            branchList.push(branchCollections.items[i].BranchBranch);
        }

        cboBranch.dispose();
        cboBranch = new wijmo.input.ComboBox('#branch_Id', {
            placeholder: "Select Branch",
            itemsSource: branchList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('branch_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                console.log(branchCollections.items[this.selectedIndex].BranchId);
                $("#branch_Id_data").val(branchCollections.items[this.selectedIndex].BranchId);
            }
        });
    }

    // =======================
    // GET Users for Combo Box
    // =======================
    function getUsersForComboBox() {
        users = new wijmo.collections.ObservableArray();
        $.ajax({
            url: '/api/listUser',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (results) {
                if (results.length > 0) {
                    for (i = 0; i < results.length; i++) {
                        users.push({
                            UserId: results[i]["Id"],
                            UserFirstName: results[i]["FirstName"],
                            UserLastName: results[i]["LastName"],
                            UserUserName: results[i]["UserName"],
                            UserEmail: results[i]["Email"]
                        });
                    }
                    createCboUserPreparedBy(users)
                    createCboUserCheckedBy(users);
                    createCboUserApprovedBy(users);
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        }
        );
    }

    // =================================
    // Combo Box for Users - Prepared By
    // =================================
    function createCboUserPreparedBy(users) {
        var usersCollection = new wijmo.collections.CollectionView(users);
        var userList = new Array();
        for (var i = 0; i < usersCollection.items.length; i++) {
            userList.push(usersCollection.items[i].UserUserName);
        }

        cboUserPreparedBy.dispose();
        cboUserPreparedBy = new wijmo.input.ComboBox('#preparedByUserId', {
            placeholder: "Select User",
            itemsSource: userList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('preparedByUserId_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                $("#preparedByUserId_Data").val(usersCollection.items[this.selectedIndex].UserId);
            }
        });
    }

    // ================================
    // Combo Box for Users - Checked By
    // ================================
    function createCboUserCheckedBy(users) {
        var usersCollection = new wijmo.collections.CollectionView(users);
        var userList = new Array();
        for (var i = 0; i < usersCollection.items.length; i++) {
            userList.push(usersCollection.items[i].UserUserName);
        }

        cboUserCheckedBy.dispose();
        cboUserCheckedBy = new wijmo.input.ComboBox('#checkedByUserId', {
            placeholder: "Select User",
            itemsSource: userList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('checkedByUserId_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                $("#checkedByUserId_Data").val(usersCollection.items[this.selectedIndex].UserId);
            }
        });
    }

    // ==================================
    // Combo Box for Users - Approved By
    // ==================================
    function createCboUserApprovedBy(users) {
        var usersCollection = new wijmo.collections.CollectionView(users);
        var userList = new Array();
        for (var i = 0; i < usersCollection.items.length; i++) {
            userList.push(usersCollection.items[i].UserUserName);
        }

        cboUserApprovedBy.dispose();
        cboUserApprovedBy = new wijmo.input.ComboBox('#approvedByUserId', {
            placeholder: "Select User",
            itemsSource: userList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('approvedByUserId_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                $("#approvedByUserId_Data").val(usersCollection.items[this.selectedIndex].UserId);
            }
        });
    }

    // ===========================
    // Journal Voucher Save Button
    // ===========================
    function cmdJournalVoucherSaveButton_OnClick() {
        var journalVoucherObject = new Object();
        var journalVoucherId = @JVId

        journalVoucherObject.BranchId = document.getElementById('branch_Id_data').value;
        journalVoucherObject.JVNumber = document.getElementById('journalVoucher_No').value;
        journalVoucherObject.ManualJVNumber = document.getElementById('manual_JournalVoucher_No').value;
        journalVoucherObject.JVDate = document.getElementById('journalVoucher_date_Data').value;
        journalVoucherObject.Particulars = document.getElementById('journalVoucher_Particulars').value;
        journalVoucherObject.PreparedById = document.getElementById('preparedByUserId_Data').value;
        journalVoucherObject.CheckedById = document.getElementById('checkedByUserId_Data').value;
        journalVoucherObject.ApprovedById = document.getElementById('approvedByUserId_Data').value;
        var data = JSON.stringify(journalVoucherObject);

        var isValid = true;
        $('.requiredJournalVoucher').each(function () {
            if ($.trim($(this).val()) == '') {
                isValid = false;
                $(this).css({
                    "border": "2px solid red",
                    "transition": "border 1s ease 0s"
                });
            }
            else {
                $(this).css({
                    "border": "",
                });
            }
        });
        if (isValid == false) {
            e.preventDefault();
        }
        else {
            if (journalVoucherId == 0) {
                $.ajax({
                    type: "POST",
                    url: '/api/addJournalVoucher',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: data,
                    statusCode: {
                        200: function () {
                            $("#cmdSaveJournalVoucher").prop("disabled", true);
                            $("#cmdEditJournalVoucher").prop("disabled", true);
                            $("#cmdPreviewJournalVoucher").prop("disabled", true);
                            $("#cmdPrintJournalVoucher").prop("disabled", true);
                            $("#cmdCloseJournalVoucher").prop("disabled", true);
                            $("#cmdSaveJournalVoucherLineButton").prop("disabled", true);
                            $("#cmdJournalVoucherLineDetailCloseButton").prop("disabled", true);
                            toastr.success("Successfully Saved");
                            setTimeout(getJournalVoucherLastInsertedId, 1000)
                        },
                        404: function () {
                            toastr.error("Can't Save");
                        },
                        400: function () {
                            toastr.error("Bad Request");
                        }
                    }
                });
            } else {
                $.ajax({
                    type: "PUT",
                    url: '/api/updateJournalVoucher/' + journalVoucherId,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: data,
                    statusCode: {
                        200: function () {
                            $("#cmdSaveJournalVoucher").prop("disabled", true);
                            $("#cmdEditJournalVoucher").prop("disabled", true);
                            $("#cmdPreviewJournalVoucher").prop("disabled", true);
                            $("#cmdPrintJournalVoucher").prop("disabled", true);
                            $("#cmdCloseJournalVoucher").prop("disabled", true);
                            $("#cmdSaveJournalVoucherLineButton").prop("disabled", true);
                            $("#cmdJournalVoucherLineDetailCloseButton").prop("disabled", true);
                            toastr.success("Successfully Updated");
                            window.setTimeout(function () {
                                location.reload()
                            }, 1000);
                        },
                        404: function () {
                            toastr.error("Can't Update");
                        },
                        400: function () {
                            toastr.error("Bad Request");
                        }
                    }
                });
            }
        }
    }

    // =================================================
    // Get Journal Voucher Line LIST / or / By Branch Id
    // =================================================
    function getJournalVoucherLineByJVId() {
        var journalVoucherLines = new wijmo.collections.ObservableArray;
        var JVId = @JVId
        $('#loadingModal').modal('show');
        $.ajax({
            url: '/api/listJournalVoucherLineByJVId/' + JVId,
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (Results) {
                $('#loadingModal').modal('hide');
                if (Results.length > 0) {
                    for (i = 0; i < Results.length; i++) {
                        journalVoucherLines.push({
                            EditId: "<button class='btn btn-primary btn-xs btn-block' onclick='cmdJournalVoucherLineEditButton_OnClick()'><i class='fa fa-pencil'></i> Edit</button>",
                            DeleteId: "<button class='btn btn-danger btn-xs btn-block' onclick='cmdJournalVoucherLineDeleteButton_OnClick()'><i class='fa fa-trash'></i> Delete</button>",
                            Id: Results[i]["Id"],
                            JVId: Results[i]["JVId"],
                            BranchId: Results[i]["BranchId"],
                            Branch: Results[i]["Branch"],
                            AccountId: Results[i]["AccountId"],
                            Account: Results[i]["Account"],
                            ArticleId: Results[i]["ArticleId"],
                            Article: Results[i]["Article"],
                            Particulars: Results[i]["Particulars"],
                            DebitAmount: Results[i]["DebitAmount"],
                            CreditAmount: Results[i]["CreditAmount"],
                            APRRId: Results[i]["APRRId"],
                            ARSIId: Results[i]["ARSIId"],
                            IsClear: Results[i]["IsClear"],
                        });
                    }
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        });
        return journalVoucherLines;
    }

    // ================================================
    // GET Branch for Combo Box in Journal Voucher Line
    // ================================================
    function getBranchesForComboBoxInJournalVoucherLine() {
        branches = new wijmo.collections.ObservableArray();
        $.ajax({
            url: '/api/listBranch',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (results) {
                if (results.length > 0) {
                    for (i = 0; i < results.length; i++) {
                        branches.push({
                            BranchId: results[i]["Id"],
                            BranchBranch: results[i]["Branch"]
                        });
                    }
                    createCboBranchForJournalVoucherLine(branches);
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        }
        );
    }

    // ==============================================
    // Combo Box for Branches in Journal Voucher Line
    // ==============================================
    function createCboBranchForJournalVoucherLine(branches) {
        var branchCollections = new wijmo.collections.CollectionView(branches);
        var branchList = new Array();
        for (var i = 0; i < branchCollections.items.length; i++) {
            branchList.push(branchCollections.items[i].BranchBranch);
        }

        cboBranchJVL.dispose();
        cboBranchJVL = new wijmo.input.ComboBox('#JVL_Branch_Id', {
            placeholder: "Select Branch",
            itemsSource: branchList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('JVL_Branch_Id_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                $("#JVL_Branch_Id_Data").val(branchCollections.items[this.selectedIndex].BranchId);
            }
        });
    }

    // ==================================================
    // GET Accounts for Combo Box in Journal Voucher Line
    // ==================================================
    function getAccountsForComboBoxInJournalVoucherLine() {
        accounts = new wijmo.collections.ObservableArray();
        $.ajax({
            url: '/api/listAccount',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (results) {
                if (results.length > 0) {
                    for (i = 0; i < results.length; i++) {
                        accounts.push({
                            AccountId: results[i]["Id"],
                            AccountAccount: results[i]["Account"]
                        });
                    }
                    createCboAccountsForJournalVoucherLine(accounts);
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        }
        );
    }

    // ==============================================
    // Combo Box for Accounts in Journal Voucher Line
    // ==============================================
    function createCboAccountsForJournalVoucherLine(accounts) {
        var accountCollections = new wijmo.collections.CollectionView(accounts);
        var accountList = new Array();
        for (var i = 0; i < accountCollections.items.length; i++) {
            accountList.push(accountCollections.items[i].AccountAccount);
        }

        cboAccountJVL.dispose();
        cboAccountJVL = new wijmo.input.ComboBox('#JVL_Account_Id', {
            placeholder: "Select Account",
            itemsSource: accountList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('JVL_Account_Id_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                $("#JVL_Account_Id_Data").val(accountCollections.items[this.selectedIndex].AccountId);
            }
        });
    }

    // ==================================================
    // GET Articles for Combo Box in Journal Voucher Line
    // ==================================================
    function getArticlesForComboBoxInJournalVoucherLine() {
        articles = new wijmo.collections.ObservableArray();
        $.ajax({
            url: '/api/listArticle',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (results) {
                if (results.length > 0) {
                    for (i = 0; i < results.length; i++) {
                        articles.push({
                            ArticleId: results[i]["Id"],
                            ArticleArticle: results[i]["Article"]
                        });
                    }
                    createCboArticlesForJournalVoucherLine(articles);
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        }
        );
    }

    // ==============================================
    // Combo Box for Articles in Journal Voucher Line
    // ==============================================
    function createCboArticlesForJournalVoucherLine(articles) {
        var articleCollections = new wijmo.collections.CollectionView(articles);
        var articleList = new Array();
        for (var i = 0; i < articleCollections.items.length; i++) {
            articleList.push(articleCollections.items[i].ArticleArticle);
        }

        cboArticleJVL.dispose();
        cboArticleJVL = new wijmo.input.ComboBox('#JVL_Aritcle_Id', {
            placeholder: "Select Article",
            itemsSource: articleList,
            isEditable: false,
            required: false,
            selectedValue: document.getElementById('JVL_Aritcle_Id_selectedValue').value.toString(),
            onSelectedIndexChanged: function () {
                $("#JVL_Aritcle_Id_Data").val(articleCollections.items[this.selectedIndex].ArticleId);
            }
        });
    }

    // =============================================
    // Journal Voucher Line ADD-Journal Voucher Line
    // =============================================
    function cmdJournalVoucherLineAddJournalVoucherLineButton_OnClick() {
        $('#journalVoucherLineEdit').modal({
            show: true,
            backdrop: 'static'
        });

        getBranchesForComboBoxInJournalVoucherLine();
        getAccountsForComboBoxInJournalVoucherLine();
        getArticlesForComboBoxInJournalVoucherLine();

        document.getElementById('JVL_Id').value = 0;
        document.getElementById('JVL_JVId').value = @JVId;
        document.getElementById('JVL_Branch_Id_Data').value = '';
        document.getElementById('JVL_Branch_Id_selectedValue').value = '';
        document.getElementById('JVL_Account_Id_Data').value = '';
        document.getElementById('JVL_Account_Id_selectedValue').value = '';
        document.getElementById('JVL_Aritcle_Id_Data').value = '';
        document.getElementById('JVL_Aritcle_Id_selectedValue').value = '';
        document.getElementById('JVL_Particulars').value = '';
        document.getElementById('JVL_DebitAmount').value = '';
        document.getElementById('JVL_CreditAmount').value = '';
        document.getElementById('JVL_APRRId').value = '';
        document.getElementById('JVL_ARSIId').value = '';
        document.getElementById('JVL_IsClear').checked  = false;
    }

    // =========================
    // EDIT Journal Voucher Line
    // =========================
    function cmdJournalVoucherLineEditButton_OnClick() {
        journalVoucherLines.editItem(journalVoucherLines.currentItem);
        $('#journalVoucherLineEdit').modal({
            show: true,
            backdrop: 'static'
        });

        getBranchesForComboBoxInJournalVoucherLine();
        getAccountsForComboBoxInJournalVoucherLine();
        getArticlesForComboBoxInJournalVoucherLine();

        var journalVoucherLine = journalVoucherLines.currentEditItem;
        document.getElementById('JVL_Id').value = journalVoucherLine.Id !== null && typeof (journalVoucherLine.Id) != 'undefined' ? wijmo.Globalize.format(journalVoucherLine.Id) : '';
        document.getElementById('JVL_JVId').value = @JVId;
        document.getElementById('JVL_Branch_Id_Data').value = journalVoucherLine.BranchId ? journalVoucherLine.BranchId : '';
        document.getElementById('JVL_Branch_Id_selectedValue').value = journalVoucherLine.Branch ? journalVoucherLine.Branch : '';
        document.getElementById('JVL_Account_Id_Data').value = journalVoucherLine.AccountId ? journalVoucherLine.AccountId : '';
        document.getElementById('JVL_Account_Id_selectedValue').value = journalVoucherLine.Account ? journalVoucherLine.Account : '';
        document.getElementById('JVL_Aritcle_Id_Data').value = journalVoucherLine.ArticleId ? journalVoucherLine.ArticleId : '';
        document.getElementById('JVL_Aritcle_Id_selectedValue').value = journalVoucherLine.Article ? journalVoucherLine.Article : '';
        document.getElementById('JVL_Particulars').value = journalVoucherLine.Particulars ? journalVoucherLine.Particulars : '';
        document.getElementById('JVL_DebitAmount').value = journalVoucherLine.DebitAmount ? journalVoucherLine.DebitAmount : '';
        document.getElementById('JVL_CreditAmount').value = journalVoucherLine.CreditAmount ? journalVoucherLine.CreditAmount : '';
        document.getElementById('JVL_APRRId').value = journalVoucherLine.APRRId ? journalVoucherLine.APRRId : '';
        document.getElementById('JVL_ARSIId').value = journalVoucherLine.ARSIId ? journalVoucherLine.ARSIId : '';
        if (journalVoucherLine.IsClear == true) {
            document.getElementById('JVL_IsClear').checked  = true;
        } else {
            document.getElementById('JVL_IsClear').checked  = false;
        }
    }

    // =========================
    // SAVE Journal Voucher Line
    // =========================
    function cmdJournalVoucherLineSaveButton_OnClick() {
        var journalVoucherLineObject = new Object();
        var journalVoucherLineId = document.getElementById('JVL_Id').value;

        journalVoucherLineObject.JVId = document.getElementById('JVL_JVId').value;
        journalVoucherLineObject.BranchId = document.getElementById('JVL_Branch_Id_Data').value;
        journalVoucherLineObject.AccountId = document.getElementById('JVL_Account_Id_Data').value;
        journalVoucherLineObject.ArticleId = document.getElementById('JVL_Aritcle_Id_Data').value;
        journalVoucherLineObject.Particulars = document.getElementById('JVL_Particulars').value;
        journalVoucherLineObject.DebitAmount = document.getElementById('JVL_DebitAmount').value;
        journalVoucherLineObject.CreditAmount = document.getElementById('JVL_CreditAmount').value;
        journalVoucherLineObject.APRRId = document.getElementById('JVL_APRRId').value;
        journalVoucherLineObject.ARSIId = document.getElementById('JVL_ARSIId').value;
        journalVoucherLineObject.IsClear = document.getElementById('JVL_IsClear').checked;
        var data = JSON.stringify(journalVoucherLineObject);

        var isValid = true;
        $('.requiredJournalVoucherLine').each(function () {
            if ($.trim($(this).val()) == '') {
                isValid = false;
                $(this).css({
                    "border": "2px solid red",
                    "transition": "border 1s ease 0s"
                });
            }
            else {
                $(this).css({
                    "border": "",
                });
            }
        });
        if (isValid == false) {
            e.preventDefault();
        }
        else {
            if (journalVoucherLineId == 0) {
                $.ajax({
                    type: "POST",
                    url: '/api/addJournalVoucherLine',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: data,
                    statusCode: {
                        200: function () {
                            $("#cmdSaveJournalVoucherLineButton").prop("disabled", true);
                            $("#cmdJournalVoucherLineDetailCloseButton").prop("disabled", true);
                            toastr.success("Successfully Saved");
                            window.setTimeout(function () {
                                location.reload()
                            }, 1000);
                        },
                        404: function () {
                            toastr.error("Can't Save");
                        },
                        400: function () {
                            toastr.error("Bad Request");
                        }
                    }
                });
            } else {
                $.ajax({
                    type: "PUT",
                    url: '/api/updateJournalVoucherLine/' + journalVoucherLineId,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: data,
                    statusCode: {
                        200: function () {
                            $("#cmdSaveJournalVoucherLineButton").prop("disabled", true);
                            $("#cmdJournalVoucherLineDetailCloseButton").prop("disabled", true);
                            toastr.success("Successfully Updated");
                            window.setTimeout(function () {
                                location.reload()
                            }, 1000);
                        },
                        404: function () {
                            toastr.error("Can't Update");
                        },
                        400: function () {
                            toastr.error("Bad Request");
                        }
                    }
                });
            }
        }
    }

    // ===========================
    // DELETE Journal Voucher Line
    // ===========================
    function cmdJournalVoucherLineDeleteButton_OnClick() {
        $('#deleteJournalVoucherConfirm').modal({
            show: true,
            backdrop: 'static'
        });
    }
    // delete confirm journal voucher line
    function cmdJournalVoucherConfirmDeleteButton_OnClick() {
        journalVoucherLines.editItem(journalVoucherLines.currentItem);
        var journalVoucherLineId = journalVoucherLines.currentEditItem.Id;
        $.ajax({
            url: '/api/deleteJournalVoucherLine/' + journalVoucherLineId,
            type: "DELETE",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            statusCode: {
                200: function () {
                    $("#cmdConfirmDeleteJournalVoucherLine").prop("disabled", true);
                    $("#cmdConfirmDeleteCloseButtonJournalVoucherLine").prop("disabled", true);
                    toastr.success("Successfully Deleted");
                    window.setTimeout(function () {
                        location.reload()
                    }, 1000);
                },
                404: function () {
                    toastr.error("Request Not Found");
                    $('#deleteJournalVoucherConfirm').modal('hide');
                },
                400: function () {
                    toastr.error("Bad Request");
                    $('#deleteJournalVoucherConfirm').modal('hide');
                }
            }
        });
    }

    // ===========================================
    // Navigation Buttons for Journal Voucher Line
    // ===========================================
    function updateNavigateButtonsJournalVoucherLine() {
        if (journalVoucherLines.pageSize <= 0) {
            document.getElementById('naviagtionPageGridJournalVoucherLine').style.display = 'none';
            return;
        }
        document.getElementById('naviagtionPageGridJournalVoucherLine').style.display = 'block';
        if (journalVoucherLines.pageIndex === 0) {
            btnFirstPageGridJournalVoucherLine.setAttribute('disabled', 'disabled');
            btnPreviousPageGridJournalVoucherLine.setAttribute('disabled', 'disabled');
            btnNextPageGridJournalVoucherLine.removeAttribute('disabled');
            btnLastPageGridJournalVoucherLine.removeAttribute('disabled');
        } else if (journalVoucherLines.pageIndex === (journalVoucherLines.pageCount - 1)) {
            btnFirstPageGridJournalVoucherLine.removeAttribute('disabled');
            btnPreviousPageGridJournalVoucherLine.removeAttribute('disabled');
            btnLastPageGridJournalVoucherLine.setAttribute('disabled', 'disabled');
            btnNextPageGridJournalVoucherLine.setAttribute('disabled', 'disabled');
        } else {
            btnFirstPageGridJournalVoucherLine.removeAttribute('disabled');
            btnPreviousPageGridJournalVoucherLine.removeAttribute('disabled');
            btnNextPageGridJournalVoucherLine.removeAttribute('disabled');
            btnLastPageGridJournalVoucherLine.removeAttribute('disabled');
        }
        btnCurrentPageGridJournalVoucherLine.innerHTML = (journalVoucherLines.pageIndex + 1) + ' / ' + journalVoucherLines.pageCount;
    }

    // ============
    // On load Page
    // ============
    $(document).ready(function () {
        document.getElementById('currentPage').innerHTML = '<a href="@Url.Action("Index", "Software")" class="currentPageLinkCustom">Main Menu</a> ' + ' / ' + '<a href="@Url.Action("JournalVoucher", "Software")" class="currentPageLinkCustom">Journal Voucher</a> ' + ' / Journal Voucher Detail';

        if(@JVId == 0) {
            $("#cmdJournalVoucherLineAddJournalVoucherLineButton").prop("disabled", true);
        } else {
            $("#cmdJournalVoucherLineAddJournalVoucherLineButton").prop("disabled", false);
        }

        getJournalVoucherById();
        getBranchesForComboBox();
        getUsersForComboBox();

        if (@JVId == 0) {
            journalVoucherDate = new wijmo.input.InputDate('#journalVoucher_Date', {
                format: 'MM/dd/yyyy',
                value: new Date(),
                mask: '99/99/9999',
                onValueChanged: function () {
                    document.getElementById('journalVoucher_date_Data').value = this.value.toLocaleDateString();
                }
            });
        }

        cboBranch = new wijmo.input.ComboBox('#branch_Id');
        cboUserPreparedBy = new wijmo.input.ComboBox('#preparedByUserId');
        cboUserCheckedBy = new wijmo.input.ComboBox('#checkedByUserId');
        cboUserApprovedBy = new wijmo.input.ComboBox('#approvedByUserId');

        cboBranchJVL  = new wijmo.input.ComboBox('#JVL_Branch_Id');
        cboAccountJVL  = new wijmo.input.ComboBox('#JVL_Account_Id');
        cboArticleJVL  = new wijmo.input.ComboBox('#JVL_Aritcle_Id');

        journalVoucherLines = new wijmo.collections.CollectionView(getJournalVoucherLineByJVId());
        journalVoucherLines.canFilter = true;
        journalVoucherLines.pageSize = 10;

        var filterTextJournalVoucherLine = '';
        $('#InputFilterJournalVoucherLine').keyup(function () {
            filterTextJournalVoucherLine = this.value.toLowerCase();
            journalVoucherLines.refresh();
        });
        journalVoucherLines.filter = function (item) {
            return !filterTextJournalVoucherLine || (item.Branch.toLowerCase().indexOf(filterTextJournalVoucherLine) > -1);
        }
        journalVoucherLines.collectionChanged.addHandler(function (sender, args) {
            updateNavigateButtonsJournalVoucherLine();
        });

        // Flex Grid
        journalVoucherLineGrid = new wijmo.grid.FlexGrid('#JournalVoucherLineGrid');
        journalVoucherLineGrid.initialize({
            columns: [
                        {
                            "header": "Edit",
                            "binding": "EditId",
                            "width": 60,
                            "align": "center",
                            "allowResizing": false,
                            "allowSorting": false,
                            "isContentHtml": true
                        },
                        {
                            "header": "Delete",
                            "binding": "DeleteId",
                            "width": 70,
                            "align": "center",
                            "allowResizing": false,
                            "allowSorting": false,
                            "isContentHtml": true
                        },
                        {
                            "header": "Branch",
                            "binding": "Branch",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*",
                        },
                        {
                            "header": "Account",
                            "binding": "Account",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "Article",
                            "binding": "Article",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "Particulars",
                            "binding": "Particulars",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "DebitAmount.",
                            "binding": "DebitAmount",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "CreditAmount",
                            "binding": "CreditAmount",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "APRRId",
                            "binding": "APRRId",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "ARSIId",
                            "binding": "ARSIId",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "Is Clear",
                            "binding": "IsClear",
                            "align": "center",
                            "allowSorting": true,
                            "width": "2*"
                        }
            ],
            autoGenerateColumns: false,
            itemsSource: journalVoucherLines,
            isReadOnly: true,
            frozenColumns: 2,
            autoSizeMode: wijmo.grid.AutoSizeMode.Both,
            allowDragging: wijmo.grid.AllowDragging.None,
            selectionMode: wijmo.grid.SelectionMode.Row
        });

        journalVoucherLineGrid.trackChanges = true;

        //Navigation button
        btnFirstPageGridJournalVoucherLine = document.getElementById('btnMoveToFirstPageGridJournalVoucherLine');
        btnPreviousPageGridJournalVoucherLine = document.getElementById('btnMoveToPreviousPageGridJournalVoucherLine');
        btnNextPageGridJournalVoucherLine = document.getElementById('btnMoveToNextPageGridJournalVoucherLine');
        btnLastPageGridJournalVoucherLine = document.getElementById('btnMoveToLastPageGridJournalVoucherLine');
        btnCurrentPageGridJournalVoucherLine = document.getElementById('btnCurrentPageGridJournalVoucherLine');

        updateNavigateButtonsJournalVoucherLine();

        btnFirstPageGridJournalVoucherLine.addEventListener('click', function () {
            journalVoucherLines.moveToFirstPage();
            updateNavigateButtonsJournalVoucherLine();
        });
        btnPreviousPageGridJournalVoucherLine.addEventListener('click', function () {
            journalVoucherLines.moveToPreviousPage();
            updateNavigateButtonsJournalVoucherLine();
        });
        btnNextPageGridJournalVoucherLine.addEventListener('click', function () {
            journalVoucherLines.moveToNextPage();
            updateNavigateButtonsJournalVoucherLine();
        });
        btnLastPageGridJournalVoucherLine.addEventListener('click', function () {
            journalVoucherLines.moveToLastPage();
            updateNavigateButtonsJournalVoucherLine();
        });
    });
    </script>
</body>
</html>