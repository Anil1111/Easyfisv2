@{
    var branchId = Request.QueryString["BranchId"];
}
<!DOCTYPE html>
<html>
<head>
    <!-- Meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="Some slide and push menu demos using CSS3 transitions.">

    <!-- Title of the Page -->
    <title>Company</title>

    <!-- CSS StyleSheets-->
    @Styles.Render("~/Font-Awesome/css")
    @Styles.Render("~/Content/Software-css")
    @Styles.Render("~/WijmoCSS/Wijmo-css")
</head>
<body>
    <div id="wrapper" class="wrapper">
        <!-- Header -->
        @Html.Partial("_SoftwareHeader")

        <!-- Section -->
        <section>
            <br /><br /><br />
            <div class="container">
                <!-- Company List -->
                <div id="companyList">
                    <div class="row">
                        <div class="col-lg-12">
                            <h4><img src='~/images/Icons/iCompany.png'> Company</h4>
                            <hr />
                            <div class="div_Current_Page">
                                @*<label id="currentBranchName"></label>*@ 
                                <span id="currentPage"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="input-group">
                                <span class="input-group-btn">
                                    <button class="btn btn-default btn-sm" type="button" readonly>
                                        <i class="fa fa-search"></i>
                                    </button>
                                </span>
                                <input type="text" class="form-control input-sm" id="InputFilter" placeholder="Search Company">
                            </div>
                        </div>
                        <div class="col-lg-8" align="right">
                            <a href="@Url.Action("CompanyDetail", "Software", new { CompanyId = 0, BranchId = branchId })" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> Add</a>
                            <a href="@Url.Action("Index", "Software", new { BranchId = branchId })" class="btn btn-danger btn-sm" id="cmdCloseButtonCompany"><i class="fa fa-times"></i> Close</a>
                        </div>
                    </div>
                    <br />
                    <div class="row" align="left">
                        <div class="col-lg-12">
                            <div id="CompanyGrid" class="grid" align="left"></div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="btn-group col-md-7" id="naviagtionPageGrid">
                            <button type="button" class="btn btn-default border-custom" id="btnMoveToFirstPageGrid">
                                <span class="glyphicon glyphicon-fast-backward"></span>
                            </button>
                            <button type="button" class="btn btn-default border-custom" id="btnMoveToPreviousPageGrid">
                                <span class="glyphicon glyphicon-step-backward"></span>
                            </button>
                            <button type="button" class="btn btn-default border-custom" disabled style="width: 100px" id="btnCurrentPageGrid"></button>
                            <button type="button" class="btn btn-default border-custom" id="btnMoveToNextPageGrid">
                                <span class="glyphicon glyphicon-step-forward"></span>
                            </button>
                            <button type="button" class="btn btn-default border-custom" id="btnMoveToLastPageGrid">
                                <span class="glyphicon glyphicon-fast-forward"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Company Delete -->
        <div class="modal fade" id="deleteCompanyConfirm" role="dialog">
            <div class="modal-dialog modal-sm">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Delete Company <i class="fa fa-trash"></i></h4>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this?
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger btn-sm" id="cmdConfirmDeleteCompany" onclick="cmdCompanyConfirmDeleteButton_OnClick()"><i class="fa fa-trash"></i> Delete</button>
                        <button id="cmdConfirmDeleteCloseButton" class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-close"></i> Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div class="modal fade" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="Loading..." aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class=" modal-dialog modal-sm">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body">
                        <h4>Loading ...</h4>
                    </div>
                    <div class="modal-footer">
                        <img class="img-thumbnail img-responsive center-block img-custom" src='~/images/loading/progress_bar.gif'>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        @Html.Partial("_SoftwareFooter")
    </div>

    <!-- SideBar Menu -->
    @Html.Partial("_SoftwareSideBarMenu")

    <div id="c-mask" class="c-mask"></div><!-- /c-mask -->
    <!-- Scripts JavaScripts -->
    @Scripts.Render("~/Scripts/Software-js")
    @Scripts.Render("~/WijmoScripts/Wijmo-js")
    <script type="text/javascript">
    // ================
    // Global Variables
    // ================
    var companies;
    var companyGrid;

    var btnFirstPageGrid;
    var btnPreviousPageGrid;
    var btnNextPageGrid;
    var btnLastPageGrid;
    var btnCurrentPageGrid;

    // ================
    // GET Company List
    // ================
    function getCompany() {
        var companies = new wijmo.collections.ObservableArray;
        $('#loadingModal').modal('show');
        $.ajax({
            url: '/api/listCompany',
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            data: {},
            success: function (Results) {
                $('#loadingModal').modal('hide');
                if (Results.length > 0) {
                    for (i = 0; i < Results.length; i++) {
                        companies.push({
                            EditId: "<button class='btn btn-primary btn-xs btn-block' id='companyEditButton' onclick='cmdCompanyEditButton_OnClick()'><i class='fa fa-pencil'></i> Edit</button>",
                            DeleteId: "<button class='btn btn-danger btn-xs btn-block' id='companyDeleteButton' onclick='cmdCompanyDeleteButton_OnClick()'><i class='fa fa-trash'></i> Delete</button>",
                            Id: Results[i]["Id"],
                            Company: Results[i]["Company"],
                            Address: Results[i]["Address"],
                            ContactNumber: Results[i]["ContactNumber"],
                            TaxNumber: Results[i]["TaxNumber"],
                            IsLocked: Results[i]["IsLocked"],
                            CreatedById: Results[i]["CreatedById"],
                            CreatedBy: Results[i]["CreatedBy"],
                            CreatedDateTime: Results[i]["CreatedDateTime"],
                            UpdatedById: Results[i]["UpdatedById"],
                            UpdatedBy: Results[i]["UpdatedBy"],
                            UpdatedDateTime: Results[i]["UpdatedDateTime"]
                        });
                    }
                }
            }
        }).fail(function (xhr, textStatus, err) {
            alert(err);
        });
        return companies;
    }

    // ===================
    // Company Edit Button
    // ===================
    function cmdCompanyEditButton_OnClick() {
        companies.editItem(companies.currentItem);
        var company = companies.currentEditItem;
        var id = company.Id !== null && typeof (company.Id) != 'undefined' ? wijmo.Globalize.format(company.Id) : 0;
        window.location = '/Software/CompanyDetail?CompanyId=' + id + '&BranchId=' + @branchId;
    }

    // =====================
    // Company delete Button
    // =====================
    function cmdCompanyDeleteButton_OnClick() {
        $('#deleteCompanyConfirm').modal({
            show: true,
            backdrop: 'static'
        });
        $("#cmdConfirmDeleteCompany").prop("disabled", false);
        $("#cmdConfirmDeleteCloseButton").prop("disabled", false);
    }
    // Company Confirm Delete Button
    function cmdCompanyConfirmDeleteButton_OnClick() {
        $("#cmdConfirmDeleteCompany").prop("disabled", true);
        $("#cmdConfirmDeleteCloseButton").prop("disabled", true);

        companies.editItem(companies.currentItem);
        var id = companies.currentEditItem.Id;
        $.ajax({
            url: '/api/deleteCompany/' + id,
            type: "DELETE",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            statusCode: {
                200: function () {
                    $("#cmdConfirmDeleteCompany").prop("disabled", true);
                    $("#cmdConfirmDeleteCloseButton").prop("disabled", true);
                    toastr.success("Successfully Deleted");
                    window.setTimeout(function () {
                        location.reload()
                    }, 1000);
                },
                404: function () {
                    toastr.error("Request Not Found");
                    $('#deleteCompanyConfirm').modal('hide');
                },
                400: function () {
                    toastr.error("Can't be deleted");
                    $('#deleteCompanyConfirm').modal('hide');
                }
            }
        });
    }

    // ===================
    // FlexGrid Selection
    // ===================
    function updateDetails() {
        var item = companies.currentItem;
        document.getElementById('createdBy').innerHTML = item.CreatedBy;
        document.getElementById('createdDate').innerHTML = item.CreatedDateTime;
        document.getElementById('updatedBy').innerHTML = item.UpdatedBy;
        document.getElementById('updatedDate').innerHTML = item.UpdatedDateTime;
    }

    // ===============================
    // Navigation Buttons for Comapany
    // ===============================
    function updateNavigateButtonsCompany() {
        if (companies.pageSize <= 0) {
            document.getElementById('naviagtionPageGrid').style.display = 'none';
            return;
        }
        document.getElementById('naviagtionPageGrid').style.display = 'block';
        if (companies.pageIndex === 0) {
            btnFirstPageGrid.setAttribute('disabled', 'disabled');
            btnPreviousPageGrid.setAttribute('disabled', 'disabled');
            btnNextPageGrid.removeAttribute('disabled');
            btnLastPageGrid.removeAttribute('disabled');
        } else if (companies.pageIndex === (companies.pageCount - 1)) {
            btnFirstPageGrid.removeAttribute('disabled');
            btnPreviousPageGrid.removeAttribute('disabled');
            btnLastPageGrid.setAttribute('disabled', 'disabled');
            btnNextPageGrid.setAttribute('disabled', 'disabled');
        } else {
            btnFirstPageGrid.removeAttribute('disabled');
            btnPreviousPageGrid.removeAttribute('disabled');
            btnNextPageGrid.removeAttribute('disabled');
            btnLastPageGrid.removeAttribute('disabled');
        }
        btnCurrentPageGrid.innerHTML = (companies.pageIndex + 1) + ' / ' + companies.pageCount;
    }

    // ============
    // On Page Load
    // ============
    $(document).ready(function () {
        $.ajax({
            url: '/api/listBranchById/' + @branchId,
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                data: {},
                success: function (results) {
                    if (results.length > 0) {
                        branches.push({
                            BranchId: results.Id,
                            BranchBranch: results.Branch
                        });
                    }
                    //document.getElementById('currentBranchName').innerHTML = '<a href="@Url.Action("Index", "Software", new { BranchId = branchId })" class="branchNameStyle">' + results.Branch + "</a>: /";
                }
            });

            document.getElementById('currentPage').innerHTML = '<a href="@Url.Action("Index", "Software", new { BranchId = branchId })" class="currentPageLinkCustom">Main Menu</a> ' + ' > Company';

        toastr.options = {
            "closeButton": true,
            "debug": true,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": true,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }

        companies = new wijmo.collections.CollectionView(getCompany());
        companies.canFilter = true;
        companies.pageSize = 10;

        var filterText = '';
        $('#InputFilter').keyup(function () {
            filterText = this.value.toLowerCase();
            companies.refresh();
        });
        companies.filter = function (item) {
            return !filterText || (item.Company.toLowerCase().indexOf(filterText) > -1);
        }
        companies.collectionChanged.addHandler(function (sender, args) {
            updateNavigateButtonsCompany();
        });
        companies.currentChanged.addHandler(function (sender, args) {
            updateDetails();
        });

        // Flex Grid
        companyGrid = new wijmo.grid.FlexGrid('#CompanyGrid');
        companyGrid.initialize({
            columns: [
                        {
                            "header": "Edit",
                            "binding": "EditId",
                            "width": 60,
                            "align": "center",
                            "allowResizing": false,
                            "allowSorting": false,
                            "isContentHtml": true
                        },
                        {
                            "header": "Delete",
                            "binding": "DeleteId",
                            "width": 70,
                            "align": "center",
                            "allowResizing": false,
                            "allowSorting": false,
                            "isContentHtml": true
                        },
                        {
                            "header": "Company",
                            "binding": "Company",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*",
                        },
                        {
                            "header": "Address",
                            "binding": "Address",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "Contact Number",
                            "binding": "ContactNumber",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        },
                        {
                            "header": "Tax Number",
                            "binding": "TaxNumber",
                            "align": "left",
                            "allowSorting": true,
                            "width": "2*"
                        }
            ],
            autoGenerateColumns: false,
            itemsSource: companies,
            isReadOnly: true,
            frozenColumns: 2,
            autoSizeMode: wijmo.grid.AutoSizeMode.Both,
            allowDragging: wijmo.grid.AllowDragging.None,
            selectionMode: wijmo.grid.SelectionMode.Row
        });

        companyGrid.trackChanges = true;

        //Navigation button
        btnFirstPageGrid = document.getElementById('btnMoveToFirstPageGrid');
        btnPreviousPageGrid = document.getElementById('btnMoveToPreviousPageGrid');
        btnNextPageGrid = document.getElementById('btnMoveToNextPageGrid');
        btnLastPageGrid = document.getElementById('btnMoveToLastPageGrid');
        btnCurrentPageGrid = document.getElementById('btnCurrentPageGrid');

        updateNavigateButtonsCompany();

        btnFirstPageGrid.addEventListener('click', function () {
            companies.moveToFirstPage();
            updateNavigateButtonsCompany();
        });
        btnPreviousPageGrid.addEventListener('click', function () {
            companies.moveToPreviousPage();
            updateNavigateButtonsCompany();
        });
        btnNextPageGrid.addEventListener('click', function () {
            companies.moveToNextPage();
            updateNavigateButtonsCompany();
        });
        btnLastPageGrid.addEventListener('click', function () {
            companies.moveToLastPage();
            updateNavigateButtonsCompany();
        });
    });
    </script>
</body>
</html>